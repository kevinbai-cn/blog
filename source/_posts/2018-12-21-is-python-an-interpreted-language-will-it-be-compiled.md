---
title: Python 是解释型语言吗？它会被编译吗？
date: 2018-12-21 06:38:34
categories:
- Python
tags:
- Python
---

一个经常听见的问题，那就是：Python 是解释型语言吗？它会被编译吗？这个问题没有想象中那么好回答。和很多人认识世界一样，习惯以一个简单的模型去评判一些事物。而事实上，里面包含了很多很多的细节。

<!-- more -->

通常的说法，编译代表着将一个高级语言转化为 CPU 能执行的机器码。当你编译 C 的时候，的确是做的这样的操作。编译的结果是一个二进制可执行文件，这时你的系统可直接运行这个程序。

与此相对的，解释的意思是这样的：程序运行时每次读源文件中的一行代码，并执行相应的操作，就这样一行一行的重复下去。当然，所谓的脚本语言就是这么运行的。

但事实上，上面的定义有太多的局限。一门真正的语言，为了拥有更多有用和强大的特性，通常采用了各种各样的实现方式。我们可以将编译理解为更通用一些：将一种语言转化为另一种语言形式。通常来说，源语言比目标语言要更高级一些，比如将 C 转化为机器码。当然，Javascript ES6 到 ES5 的转化也算是一种编译。

{% fi 1.jpg,,, 80% %}

在 Python 中，源代码会被编译为更低级的一种形式，我们称之为字节码。字节码是一串指令，和 CPU 的指令集类似。但是字节码并不直接被 CPU 执行，而是在虚拟机中执行的。当然，这里的虚拟机并不模仿整个操作系统的环境，只是提供了字节码执行的一个环境。

下面我们看 Python 的一小段代码以及它对应的字节码

{% fi 2.jpg,,, 80% %}

看了字节码的内容后，我们就知道 f'...' 这种格式化字符串的形式的运行原理，就是将里面的字符串转化为一系列的字面字符串与变量，然后使用 + 号连接起来。

dis 是 Python 标准库中反汇编模块，它可以展示 Python 代码的字节码信息。上面提到的执行字节码的虚拟机，可以用任意的语言实现，包括 Python 自己。有兴趣的可以去 GitHub 上看下这个项目 nedbat/byterun 。这个项目可以用来学习，但不适用于生产环境。

不过，我们运行 Python 时完全感受不到它的编译过程，没有显式的调用什么编译程序，仅仅是简单的执行 .py 文件，编译都是需要时自动编译的。这和 JAVA 不同，当你每次写完 JAVA 代码要执行时，都要手动将其编译为 .class 文件，然后执行。也正是这个原因，JAVA 被称为编译型语言，而 Python 被叫做解释型语言。但事实上，两种语言执行时都会先编译成字节码，然后交给虚拟机执行。

Python 还有一个重要的特性，就是交互式命令行。你可以敲入一行 Python 语句，然后立刻回车执行。实际上，即使是这个过程，Python 同样是先转为字节码，然后执行。而这个交互式命令行这个特性，在很多编译型语言里是没有的。同样因为没有显示的调用编译程序，很多人将执行 Python 源文件的程序叫做 Python 解释器。

即使比较简略，但还是补充下。部分编译型语言比如 C 或者 JAVA 也有交互式命令行，但这些并不是这些语言的重心。JAVA 刚开始是编译成字节码然后执行，后面有了即时编译技术（JIT）可以直接编译成机器码，与 C 类似。

从上面的描述可以看出，不管是解释还是编译，并没法完全分离开来。很多时候，我们想用一些词将现有的编程语言分个类，但事实上要办到这一点太难了。

最后要说明的是，你的代码是怎么执行的只是语言的实现问题，并非语言的特征。上文中，我们讨论的是 Python，但实际上是 CPython 的描述。CPython 是一个解释器，之所以这么叫，是因为这个解释器是用 C 编写的，这也是 Python 默认的解释器。当然还有其它很多解释器，比如，PyPy 就是另一种解释器，使用了 JIT 技术，运行速度相比 CPython 有较大提升。

回到标题中的问题，Python 之所以称为解释型语言，是因为它没有显示的调用编译操作，表现出解释型的特性比较多而已。但事实上，编译是存在的，具体怎么编译就看语言的实现了，也就是解释器的设计。
